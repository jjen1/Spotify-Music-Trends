-- 8. What are the frequent release dates of songs that end up being popular? 

WITH track_popularity AS (
    SELECT 
        t.track_id,
        t.name AS track_name,
        t.popularity AS track_popularity,
		a.album_id,
        DENSE_RANK() OVER (ORDER BY t.popularity DESC) AS track_ranking
    FROM track t
    LEFT JOIN album a ON a.album_id = t.album_id AND a.artist_id = t.artist_id
    WHERE t.popularity >= 50
),
popular_albums AS (
    SELECT DISTINCT a.album_id, a.release_date
    FROM album a
    JOIN track_popularity tp ON a.album_id = tp.album_id
),
release_date_counts AS (
    SELECT 
        release_date,
        COUNT(*) AS release_count
    FROM popular_albums
    GROUP BY release_date
)
SELECT 
    release_date,
    release_count
FROM release_date_counts
ORDER BY release_count DESC;

